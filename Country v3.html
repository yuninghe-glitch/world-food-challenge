<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NYC World Food Challenge</title>
<style>
body {margin:0;font-family:-apple-system,BlinkMacSystemFont,"Helvetica Neue",sans-serif;
background:linear-gradient(135deg,#fff7f9,#fdecef);
display:flex;align-items:center;justify-content:center;height:100vh;user-select:none;}
.card {background:white;border-radius:26px;padding:28px 20px;width:95%;max-width:440px;text-align:center;box-shadow:0 20px 50px rgba(0,0,0,0.08);overflow-y:auto;max-height:95vh;}
h1{font-size:18px;margin-bottom:12px;}
.lang{font-size:12px;color:#999;text-align:right;cursor:pointer;}
.flag{font-size:44px;margin:10px 0 4px;}
.country{font-size:36px;font-weight:800;}
.cn{font-size:18px;color:#666;margin-bottom:14px;}
.input-log{margin:6px 0;font-size:14px;padding:6px 8px;width:100%;border-radius:8px;border:1px solid #ddd;}
button{width:100%;padding:14px;font-size:16px;border-radius:16px;border:none;font-weight:700;cursor:pointer;margin-bottom:10px;}
.primary{background:#ff4f87;color:white;}
.secondary{background:#f3f3f3;color:#333;}
.meta{margin-top:10px;font-size:13px;color:#999;display:flex;justify-content:space-between;}
.reset{margin-top:14px;font-size:12px;color:#bbb;text-decoration:underline;cursor:pointer;}
.caption{margin-top:10px;font-size:14px;color:#333;background:#fff0f4;padding:10px;border-radius:12px;white-space:pre-line;}
#log{margin-top:16px;text-align:left;max-height:220px;overflow-y:auto;padding:6px;background:#fff5f8;border-radius:12px;}
.log-entry{border-bottom:1px solid #eee;padding:6px 0;font-size:13px;}
.log-entry:last-child{border-bottom:none;}
.log-entry a{color:#ff4f87;text-decoration:underline;}
.share-card{margin-top:12px;padding:12px;border-radius:14px;background:#ffe6f0;text-align:center;}
.share-card button{margin-top:6px;width:100%;font-size:14px;}
</style>
</head>
<body>
<div class="card">
<div class="lang" onclick="toggleLang()">ğŸŒ EN / ä¸­æ–‡</div>
<h1 id="title">NYC World Food Challenge</h1>

<div class="flag" id="flag">ğŸ²</div>
<div class="country" id="country">Tap to start</div>
<div class="cn" id="subtitle">One country per week</div>

<input type="text" id="restaurantName" placeholder="Restaurant Name / é¤å…åç§°" class="input-log"/>
<input type="text" id="restaurantAddr" placeholder="Address / åœ°å€" class="input-log"/>
<button class="primary" onclick="generateCountry()" id="genBtn">Generate Country</button>
<button class="secondary" onclick="completeCountry()" id="doneBtn" disabled>Mark as Completed</button>
<button class="secondary" onclick="undoLast()" id="undoBtn">Undo Last</button>

<div class="meta">
  <div id="week">Week 0</div>
  <div id="progress">0 / 195</div>
</div>

<div class="caption" id="caption">Your bilingual caption will appear here.</div>

<div id="log"></div>

<div class="share-card">
  <button onclick="generateShareCard()">Generate Share Card</button>
  <div id="shareCardPreview" style="margin-top:8px;"></div>
</div>

<div class="reset" onclick="resetAll()" id="resetText">Reset Challenge</div>
</div>

<script>
/* LANGUAGE */
let lang=localStorage.getItem("lang")||"en";
const text={en:{title:"NYC World Food Challenge",subtitle:"One country per week",gen:"Generate Country",done:"Mark as Completed",reset:"Reset Challenge",undo:"Undo Last"},zh:{title:"çº½çº¦åƒéå…¨ä¸–ç•ŒæŒ‘æˆ˜",subtitle:"æ¯å‘¨ä¸€ä¸ªå›½å®¶",gen:"éšæœºç”Ÿæˆå›½å®¶",done:"å®Œæˆå¹¶æ‰“å¡",reset:"é‡ç½®æŒ‘æˆ˜",undo:"æ’¤é”€ä¸Šæ¬¡"}};
function applyLang(){document.getElementById("title").textContent=text[lang].title;document.getElementById("subtitle").textContent=text[lang].subtitle;document.getElementById("genBtn").textContent=text[lang].gen;document.getElementById("doneBtn").textContent=text[lang].done;document.getElementById("undoBtn").textContent=text[lang].undo;document.getElementById("resetText").textContent=text[lang].reset;}
function toggleLang(){lang=lang==="en"?"zh":"en";localStorage.setItem("lang",lang);applyLang();}

/* COUNTRIES 195 */
const countries=[["Afghanistan","é˜¿å¯Œæ±—","ğŸ‡¦ğŸ‡«"],["Albania","é˜¿å°”å·´å°¼äºš","ğŸ‡¦ğŸ‡±"],["Algeria","é˜¿å°”åŠåˆ©äºš","ğŸ‡©ğŸ‡¿"],["Andorra","å®‰é“å°”","ğŸ‡¦ğŸ‡©"],["Angola","å®‰å“¥æ‹‰","ğŸ‡¦ğŸ‡´"],["Antigua and Barbuda","å®‰æç“œå’Œå·´å¸ƒè¾¾","ğŸ‡¦ğŸ‡¬"],["Argentina","é˜¿æ ¹å»·","ğŸ‡¦ğŸ‡·"],["Armenia","äºšç¾å°¼äºš","ğŸ‡¦ğŸ‡²"],["Australia","æ¾³å¤§åˆ©äºš","ğŸ‡¦ğŸ‡º"],["Austria","å¥¥åœ°åˆ©","ğŸ‡¦ğŸ‡¹"],["Azerbaijan","é˜¿å¡æ‹œç–†","ğŸ‡¦ğŸ‡¿"],["Bahamas","å·´å“ˆé©¬","ğŸ‡§ğŸ‡¸"],["Bahrain","å·´æ—","ğŸ‡§ğŸ‡­"],["Bangladesh","å­ŸåŠ æ‹‰å›½","ğŸ‡§ğŸ‡©"],["Barbados","å·´å·´å¤šæ–¯","ğŸ‡§ğŸ‡§"],["Belarus","ç™½ä¿„ç½—æ–¯","ğŸ‡§ğŸ‡¾"],["Belgium","æ¯”åˆ©æ—¶","ğŸ‡§ğŸ‡ª"],["Belize","ä¼¯åˆ©å…¹","ğŸ‡§ğŸ‡¿"],["Benin","è´å®","ğŸ‡§ğŸ‡¯"],["Bhutan","ä¸ä¸¹","ğŸ‡§ğŸ‡¹"],["Bolivia","ç»åˆ©ç»´äºš","ğŸ‡§ğŸ‡´"],["Bosnia and Herzegovina","æ³¢æ–¯å°¼äºšå’Œé»‘å¡å“¥ç»´é‚£","ğŸ‡§ğŸ‡¦"],["Botswana","åšèŒ¨ç“¦çº³","ğŸ‡§ğŸ‡¼"],["Brazil","å·´è¥¿","ğŸ‡§ğŸ‡·"],["Brunei","æ–‡è±","ğŸ‡§ğŸ‡³"],["Bulgaria","ä¿åŠ åˆ©äºš","ğŸ‡§ğŸ‡¬"],["Burkina Faso","å¸ƒåŸºçº³æ³•ç´¢","ğŸ‡§ğŸ‡«"],["Burundi","å¸ƒéš†è¿ª","ğŸ‡§ğŸ‡®"],["Cabo Verde","ä½›å¾—è§’","ğŸ‡¨ğŸ‡»"],["Cambodia","æŸ¬åŸ”å¯¨","ğŸ‡°ğŸ‡­"],["Cameroon","å–€éº¦éš†","ğŸ‡¨ğŸ‡²"],["Canada","åŠ æ‹¿å¤§","ğŸ‡¨ğŸ‡¦"],["Central African Republic","ä¸­éå…±å’Œå›½","ğŸ‡¨ğŸ‡«"],["Chad","ä¹å¾—","ğŸ‡¹ğŸ‡©"],["Chile","æ™ºåˆ©","ğŸ‡¨ğŸ‡±"],["China","ä¸­å›½","ğŸ‡¨ğŸ‡³"],["Colombia","å“¥ä¼¦æ¯”äºš","ğŸ‡¨ğŸ‡´"],["Comoros","ç§‘æ‘©ç½—","ğŸ‡°ğŸ‡²"],["Congo (Congo-Brazzaville)","åˆšæœï¼ˆå¸ƒï¼‰","ğŸ‡¨ğŸ‡¬"],["Costa Rica","å“¥æ–¯è¾¾é»åŠ ","ğŸ‡¨ğŸ‡·"],["Croatia","å…‹ç½—åœ°äºš","ğŸ‡­ğŸ‡·"],["Cuba","å¤å·´","ğŸ‡¨ğŸ‡º"],["Cyprus","å¡æµ¦è·¯æ–¯","ğŸ‡¨ğŸ‡¾"],["Czechia","æ·å…‹","ğŸ‡¨ğŸ‡¿"],["Denmark","ä¸¹éº¦","ğŸ‡©ğŸ‡°"],["Djibouti","å‰å¸ƒæ","ğŸ‡©ğŸ‡¯"],["Dominica","å¤šç±³å°¼å…‹","ğŸ‡©ğŸ‡²"],["Dominican Republic","å¤šç±³å°¼åŠ å…±å’Œå›½","ğŸ‡©ğŸ‡´"],["Ecuador","å„ç“œå¤šå°”","ğŸ‡ªğŸ‡¨"],["Egypt","åŸƒåŠ","ğŸ‡ªğŸ‡¬"],["El Salvador","è¨å°”ç“¦å¤š","ğŸ‡¸ğŸ‡»"],["Equatorial Guinea","èµ¤é“å‡ å†…äºš","ğŸ‡¬ğŸ‡¶"],["Eritrea","å„ç«‹ç‰¹é‡Œäºš","ğŸ‡ªğŸ‡·"],["Estonia","çˆ±æ²™å°¼äºš","ğŸ‡ªğŸ‡ª"],["Eswatini","æ–¯å¨å£«å…°","ğŸ‡¸ğŸ‡¿"],["Ethiopia","åŸƒå¡ä¿„æ¯”äºš","ğŸ‡ªğŸ‡¹"],["Fiji","æ–æµ","ğŸ‡«ğŸ‡¯"],["Finland","èŠ¬å…°","ğŸ‡«ğŸ‡®"],["France","æ³•å›½","ğŸ‡«ğŸ‡·"],["Gabon","åŠ è“¬","ğŸ‡¬ğŸ‡¦"],["Gambia","å†ˆæ¯”äºš","ğŸ‡¬ğŸ‡²"],["Georgia","æ ¼é²å‰äºš","ğŸ‡¬ğŸ‡ª"],["Germany","å¾·å›½","ğŸ‡©ğŸ‡ª"],["Ghana","åŠ çº³","ğŸ‡¬ğŸ‡­"],["Greece","å¸Œè…Š","ğŸ‡¬ğŸ‡·"],["Grenada","æ ¼æ—çº³è¾¾","ğŸ‡¬ğŸ‡©"],["Guatemala","å±åœ°é©¬æ‹‰","ğŸ‡¬ğŸ‡¹"],["Guinea","å‡ å†…äºš","ğŸ‡¬ğŸ‡³"],["Guinea-Bissau","å‡ å†…äºšæ¯”ç»","ğŸ‡¬ğŸ‡¼"],["Guyana","åœ­äºšé‚£","ğŸ‡¬ğŸ‡¾"],["Haiti","æµ·åœ°","ğŸ‡­ğŸ‡¹"],["Honduras","æ´ªéƒ½æ‹‰æ–¯","ğŸ‡­ğŸ‡³"],["Hungary","åŒˆç‰™åˆ©","ğŸ‡­ğŸ‡º"],["Iceland","å†°å²›","ğŸ‡®ğŸ‡¸"],["India","å°åº¦","ğŸ‡®ğŸ‡³"],["Indonesia","å°åº¦å°¼è¥¿äºš","ğŸ‡®ğŸ‡©"],["Iran","ä¼Šæœ—","ğŸ‡®ğŸ‡·"],["Iraq","ä¼Šæ‹‰å…‹","ğŸ‡®ğŸ‡¶"],["Ireland","çˆ±å°”å…°","ğŸ‡®ğŸ‡ª"],["Israel","ä»¥è‰²åˆ—","ğŸ‡®ğŸ‡±"],["Italy","æ„å¤§åˆ©","ğŸ‡®ğŸ‡¹"],["Jamaica","ç‰™ä¹°åŠ ","ğŸ‡¯ğŸ‡²"],["Japan","æ—¥æœ¬","ğŸ‡¯ğŸ‡µ"],["Jordan","çº¦æ—¦","ğŸ‡¯ğŸ‡´"],["Kazakhstan","å“ˆè¨å…‹æ–¯å¦","ğŸ‡°ğŸ‡¿"],["Kenya","è‚¯å°¼äºš","ğŸ‡°ğŸ‡ª"],["Kiribati","åŸºé‡Œå·´æ–¯","ğŸ‡°ğŸ‡®"],["Kuwait","ç§‘å¨ç‰¹","ğŸ‡°ğŸ‡¼"],["Kyrgyzstan","å‰å°”å‰æ–¯æ–¯å¦","ğŸ‡°ğŸ‡¬"],["Laos","è€æŒ","ğŸ‡±ğŸ‡¦"],["Latvia","æ‹‰è„±ç»´äºš","ğŸ‡±ğŸ‡»"],["Lebanon","é»å·´å«©","ğŸ‡±ğŸ‡§"],["Lesotho","è±ç´¢æ‰˜","ğŸ‡±ğŸ‡¸"],["Liberia","åˆ©æ¯”é‡Œäºš","ğŸ‡±ğŸ‡·"],["Libya","åˆ©æ¯”äºš","ğŸ‡±ğŸ‡¾"],["Liechtenstein","åˆ—æ”¯æ•¦å£«ç™»","ğŸ‡±ğŸ‡®"],["Lithuania","ç«‹é™¶å®›","ğŸ‡±ğŸ‡¹"],["Luxembourg","å¢æ£®å ¡","ğŸ‡±ğŸ‡º"],["Madagascar","é©¬è¾¾åŠ æ–¯åŠ ","ğŸ‡²ğŸ‡¬"],["Malawi","é©¬æ‹‰ç»´","ğŸ‡²ğŸ‡¼"],["Malaysia","é©¬æ¥è¥¿äºš","ğŸ‡²ğŸ‡¾"],["Maldives","é©¬å°”ä»£å¤«","ğŸ‡²ğŸ‡»"],["Mali","é©¬é‡Œ","ğŸ‡²ğŸ‡±"],["Malta","é©¬è€³ä»–","ğŸ‡²ğŸ‡¹"],["Marshall Islands","é©¬ç»å°”ç¾¤å²›","ğŸ‡²ğŸ‡­"],["Mauritania","æ¯›é‡Œå¡”å°¼äºš","ğŸ‡²ğŸ‡·"],["Mauritius","æ¯›é‡Œæ±‚æ–¯","ğŸ‡²ğŸ‡º"],["Mexico","å¢¨è¥¿å“¥","ğŸ‡²ğŸ‡½"],["Micronesia","å¯†å…‹ç½—å°¼è¥¿äºš","ğŸ‡«ğŸ‡²"],["Moldova","æ‘©å°”å¤šç“¦","ğŸ‡²ğŸ‡©"],["Monaco","æ‘©çº³å“¥","ğŸ‡²ğŸ‡¨"],["Mongolia","è’™å¤","ğŸ‡²ğŸ‡³"],["Montenegro","é»‘å±±","ğŸ‡²ğŸ‡ª"],["Morocco","æ‘©æ´›å“¥","ğŸ‡²ğŸ‡¦"],["Mozambique","è«æ¡‘æ¯”å…‹","ğŸ‡²ğŸ‡¿"],["Myanmar","ç¼…ç”¸","ğŸ‡²ğŸ‡²"],["Namibia","çº³ç±³æ¯”äºš","ğŸ‡³ğŸ‡¦"],["Nauru","ç‘™é²","ğŸ‡³ğŸ‡·"],["Nepal","å°¼æ³Šå°”","ğŸ‡³ğŸ‡µ"],["Netherlands","è·å…°","ğŸ‡³ğŸ‡±"],["New Zealand","æ–°è¥¿å…°","ğŸ‡³ğŸ‡¿"],["Nicaragua","å°¼åŠ æ‹‰ç“œ","ğŸ‡³ğŸ‡®"],["Niger","å°¼æ—¥å°”","ğŸ‡³ğŸ‡ª"],["Nigeria","å°¼æ—¥åˆ©äºš","ğŸ‡³ğŸ‡¬"],["North Macedonia","åŒ—é©¬å…¶é¡¿","ğŸ‡²ğŸ‡°"],["Norway","æŒªå¨","ğŸ‡³ğŸ‡´"],["Oman","é˜¿æ›¼","ğŸ‡´ğŸ‡²"],["Pakistan","å·´åŸºæ–¯å¦","ğŸ‡µğŸ‡°"],["Palau","å¸•åŠ³","ğŸ‡µğŸ‡¼"],["Palestine","å·´å‹’æ–¯å¦","ğŸ‡µğŸ‡¸"],["Panama","å·´æ‹¿é©¬","ğŸ‡µğŸ‡¦"],["Papua New Guinea","å·´å¸ƒäºšæ–°å‡ å†…äºš","ğŸ‡µğŸ‡¬"],["Paraguay","å·´æ‹‰åœ­","ğŸ‡µğŸ‡¾"],["Peru","ç§˜é²","ğŸ‡µğŸ‡ª"],["Philippines","è²å¾‹å®¾","ğŸ‡µğŸ‡­"],["Poland","æ³¢å…°","ğŸ‡µğŸ‡±"],["Portugal","è‘¡è„ç‰™","ğŸ‡µğŸ‡¹"],["Qatar","å¡å¡”å°”","ğŸ‡¶ğŸ‡¦"],["Romania","ç½—é©¬å°¼äºš","ğŸ‡·ğŸ‡´"],["Russia","ä¿„ç½—æ–¯","ğŸ‡·ğŸ‡º"],["Rwanda","å¢æ—ºè¾¾","ğŸ‡·ğŸ‡¼"],["Saint Kitts and Nevis","åœ£åŸºèŒ¨å’Œå°¼ç»´æ–¯","ğŸ‡°ğŸ‡³"],["Saint Lucia","åœ£å¢è¥¿äºš","ğŸ‡±ğŸ‡¨"],["Saint Vincent and the Grenadines","åœ£æ–‡æ£®ç‰¹å’Œæ ¼æ—çº³ä¸æ–¯","ğŸ‡»ğŸ‡¨"],["Samoa","è¨æ‘©äºš","ğŸ‡¼ğŸ‡¸"],["San Marino","åœ£é©¬åŠ›è¯º","ğŸ‡¸ğŸ‡²"],["Sao Tome and Principe","åœ£å¤šç¾å’Œæ™®æ—è¥¿æ¯”","ğŸ‡¸ğŸ‡¹"],["Saudi Arabia","æ²™ç‰¹é˜¿æ‹‰ä¼¯","ğŸ‡¸ğŸ‡¦"],["Senegal","å¡å†…åŠ å°”","ğŸ‡¸ğŸ‡³"],["Serbia","å¡å°”ç»´äºš","ğŸ‡·ğŸ‡¸"],["Seychelles","å¡èˆŒå°”","ğŸ‡¸ğŸ‡¨"],["Sierra Leone","å¡æ‹‰åˆ©æ˜‚","ğŸ‡¸ğŸ‡±"],["Singapore","æ–°åŠ å¡","ğŸ‡¸ğŸ‡¬"],["Slovakia","æ–¯æ´›ä¼å…‹","ğŸ‡¸ğŸ‡°"],["Slovenia","æ–¯æ´›æ–‡å°¼äºš","ğŸ‡¸ğŸ‡®"],["Solomon Islands","æ‰€ç½—é—¨ç¾¤å²›","ğŸ‡¸ğŸ‡§"],["Somalia","ç´¢é©¬é‡Œ","ğŸ‡¸ğŸ‡´"],["South Africa","å—é","ğŸ‡¿ğŸ‡¦"],["South Sudan","å—è‹ä¸¹","ğŸ‡¸ğŸ‡¸"],["Spain","è¥¿ç­ç‰™","ğŸ‡ªğŸ‡¸"],["Sri Lanka","æ–¯é‡Œå…°å¡","ğŸ‡±ğŸ‡°"],["Sudan","è‹ä¸¹","ğŸ‡¸ğŸ‡©"],["Suriname","è‹é‡Œå—","ğŸ‡¸ğŸ‡·"],["Sweden","ç‘å…¸","ğŸ‡¸ğŸ‡ª"],["Switzerland","ç‘å£«","ğŸ‡¨ğŸ‡­"],["Syria","å™åˆ©äºš","ğŸ‡¸ğŸ‡¾"],["Taiwan","å°æ¹¾","ğŸ‡¹ğŸ‡¼"],["Tajikistan","å¡”å‰å…‹æ–¯å¦","ğŸ‡¹ğŸ‡¯"],["Tanzania","å¦æ¡‘å°¼äºš","ğŸ‡¹ğŸ‡¿"],["Thailand","æ³°å›½","ğŸ‡¹ğŸ‡­"],["Timor-Leste","ä¸œå¸æ±¶","ğŸ‡¹ğŸ‡±"],["Togo","å¤šå“¥","ğŸ‡¹ğŸ‡¬"],["Tonga","æ±¤åŠ ","ğŸ‡¹ğŸ‡´"],["Trinidad and Tobago","ç‰¹ç«‹å°¼è¾¾å’Œå¤šå·´å“¥","ğŸ‡¹ğŸ‡¹"],["Tunisia","çªå°¼æ–¯","ğŸ‡¹ğŸ‡³"],["Turkey","åœŸè€³å…¶","ğŸ‡¹ğŸ‡·"],["Turkmenistan","åœŸåº“æ›¼æ–¯å¦","ğŸ‡¹ğŸ‡²"],["Tuvalu","å›¾ç“¦å¢","ğŸ‡¹ğŸ‡»"],["Uganda","ä¹Œå¹²è¾¾","ğŸ‡ºğŸ‡¬"],["Ukraine","ä¹Œå…‹å…°","ğŸ‡ºğŸ‡¦"],["United Arab Emirates","é˜¿è”é…‹","ğŸ‡¦ğŸ‡ª"],["United Kingdom","è‹±å›½","ğŸ‡¬ğŸ‡§"],["United States","ç¾å›½","ğŸ‡ºğŸ‡¸"],["Uruguay","ä¹Œæ‹‰åœ­","ğŸ‡ºğŸ‡¾"],["Uzbekistan","ä¹Œå…¹åˆ«å…‹æ–¯å¦","ğŸ‡ºğŸ‡¿"],["Vanuatu","ç“¦åŠªé˜¿å›¾","ğŸ‡»ğŸ‡º"],["Vatican City","æ¢µè’‚å†ˆ","ğŸ‡»ğŸ‡¦"],["Venezuela","å§”å†…ç‘æ‹‰","ğŸ‡»ğŸ‡ª"],["Vietnam","è¶Šå—","ğŸ‡»ğŸ‡³"],["Yemen","ä¹Ÿé—¨","ğŸ‡¾ğŸ‡ª"],["Zambia","èµæ¯”äºš","ğŸ‡¿ğŸ‡²"],["Zimbabwe","æ´¥å·´å¸ƒéŸ¦","ğŸ‡¿ğŸ‡¼"]];

/* STATE */
let remaining=JSON.parse(localStorage.getItem("remainingCountries"))||[...countries];
let completed=JSON.parse(localStorage.getItem("completedCountries"))||[];
let current=JSON.parse(localStorage.getItem("currentCountry"))||null;

/* FUNCTIONS */
function generateCountry(){
  if(remaining.length===0) return;
  const i=Math.floor(Math.random()*remaining.length);
  current=remaining[i]; localStorage.setItem("currentCountry",JSON.stringify(current));
  document.getElementById("flag").textContent=current[2];
  document.getElementById("country").textContent=current[0];
  document.getElementById("subtitle").textContent=current[1];
  document.getElementById("doneBtn").disabled=false;
  updateCaption();
}

function completeCountry(){
  if(!current) return;
  const name=document.getElementById("restaurantName").value||"Unknown";
  const addr=document.getElementById("restaurantAddr").value||"";
  completed.push({...current,restaurant:name,address:addr});
  remaining=remaining.filter(c=>c[0]!==current[0]);
  localStorage.setItem("completedCountries",JSON.stringify(completed));
  localStorage.setItem("remainingCountries",JSON.stringify(remaining));
  localStorage.removeItem("currentCountry");
  current=null;
  document.getElementById("doneBtn").disabled=true;
  document.getElementById("restaurantName").value="";
  document.getElementById("restaurantAddr").value="";
  updateLog();
  updateMeta();
  document.getElementById("flag").textContent="ğŸ²";
  document.getElementById("country").textContent=lang==="en"?"Tap to start":"ç‚¹å‡»å¼€å§‹";
  document.getElementById("subtitle").textContent=lang==="en"?"One country per week":"æ¯å‘¨ä¸€ä¸ªå›½å®¶";
  updateCaption();
}

function undoLast(){
  if(completed.length===0) return;
  const last=completed.pop();
  remaining.push([last[0],last[1],last[2]]);
  localStorage.setItem("completedCountries",JSON.stringify(completed));
  localStorage.setItem("remainingCountries",JSON.stringify(remaining));
  updateLog();
  updateMeta();
}

function updateLog(){
  const log=document.getElementById("log");
  log.innerHTML="";
  completed.forEach((c,i)=>{
    let entry=document.createElement("div");
    entry.className="log-entry";
    entry.innerHTML=`${i+1}. ${c[2]} ${c[0]} / ${c[1]} â€” ${c.restaurant} <a href="https://www.google.com/maps/search/${encodeURIComponent(c.restaurant+' '+c.address)}" target="_blank">Map</a>`;
    log.appendChild(entry);
  });
}

function updateMeta(){
  document.getElementById("week").textContent=`Week ${completed.length}`;
  document.getElementById("progress").textContent=`${completed.length} / ${countries.length}`;
}

function resetAll(){
  if(!confirm(lang==="en"?"Reset everything?":"ç¡®å®šè¦é‡ç½®å—ï¼Ÿ")) return;
  remaining=[...countries]; completed=[]; current=null;
  localStorage.removeItem("completedCountries");
  localStorage.removeItem("remainingCountries");
  localStorage.removeItem("currentCountry");
  document.getElementById("flag").textContent="ğŸ²";
  document.getElementById("country").textContent=lang==="en"?"Tap to start":"ç‚¹å‡»å¼€å§‹";
  document.getElementById("subtitle").textContent=lang==="en"?"One country per week":"æ¯å‘¨ä¸€ä¸ªå›½å®¶";
  document.getElementById("restaurantName").value="";
  document.getElementById("restaurantAddr").value="";
  updateLog(); updateMeta(); updateCaption();
}

function updateCaption(){
  let cap="";
  if(current){
    cap=`${current[2]} ${current[0]} / ${current[1]}\n${document.getElementById("restaurantName").value||"Restaurant Name"}\n${document.getElementById("restaurantAddr").value||"Address"}`;
  } else {
    cap=lang==="en"?"Your bilingual caption will appear here.":"åŒè¯­æ ‡é¢˜å°†æ˜¾ç¤ºåœ¨è¿™é‡Œã€‚";
  }
  document.getElementById("caption").textContent=cap;
}

function generateShareCard(){
  if(!current && completed.length===0){
    alert(lang==="en"?"No country selected yet":"è¿˜æ²¡æœ‰é€‰æ‹©å›½å®¶");
    return;
  }
  let card=document.getElementById("shareCardPreview");
  let lastEntry=current?current:completed[completed.length-1];
  let restaurantName=document.getElementById("restaurantName").value||"Restaurant Name";
  let addr=document.getElementById("restaurantAddr").value||"Address";
  card.innerHTML=`<div style="background:#fff0f4;padding:12px;border-radius:16px;">
  <div style="font-size:36px;text-align:center;">${lastEntry[2]}</div>
  <div style="font-weight:700;text-align:center;font-size:24px;">${lastEntry[0]} / ${lastEntry[1]}</div>
  <div style="margin-top:6px;text-align:center;">${restaurantName}<br>${addr}</div>
  <a href="https://www.google.com/maps/search/${encodeURIComponent(restaurantName+' '+addr)}" target="_blank" style="display:block;margin-top:6px;text-align:center;color:#ff4f87;text-decoration:underline;">Map</a>
  </div>`;
}

/* INIT */
applyLang();
updateLog();
updateMeta();
</script>
</body>
</html>
